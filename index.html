<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê—Ä—Ö–∏–≤ –æ—Ü–µ–Ω–æ–∫ –∞–ª—å–±–æ–º–æ–≤</title>
    <style>
        :root {
            --bg: #0f0f0f;
            --card: #1a1a1a;
            --accent: #8a2be2; /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è 10 */
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: #eee; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 800px; width: 100%; }
        
        /* –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */
        .calculator { background: var(--card); padding: 15px; border-radius: 10px; margin-bottom: 30px; border: 1px solid #333; }
        .calculator input { background: #000; border: 1px solid #444; color: #fff; padding: 8px; width: 70%; border-radius: 5px; }
        .btn { background: var(--accent); border: none; color: #fff; padding: 8px 15px; border-radius: 5px; cursor: pointer; transition: 0.3s; }
        .btn:hover { opacity: 0.8; }

        /* –§–∏–ª—å—Ç—Ä—ã */
        .filters { margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
        .filter-btn { background: #333; border: none; color: #ccc; padding: 10px 15px; border-radius: 20px; cursor: pointer; }
        .filter-btn.active { background: var(--accent); color: #fff; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π */
        .artist-block { background: var(--card); border-radius: 12px; padding: 20px; margin-bottom: 25px; border-left: 4px solid var(--accent); }
        .artist-name { font-size: 1.5rem; font-weight: bold; margin-bottom: 15px; color: #fff; border-bottom: 1px solid #333; padding-bottom: 5px; }
        
        /* –°–ø–∏—Å–æ–∫ –∞–ª—å–±–æ–º–æ–≤ */
        .album-item { margin-bottom: 15px; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.03); }
        .album-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .album-title { font-size: 1.1rem; }
        .collab { font-size: 0.8rem; color: #888; margin-left: 5px; }
        
        /* –û—Ü–µ–Ω–∫–∏ –∏ –¶–≤–µ—Ç–∞ */
        .rating-badge { padding: 4px 10px; border-radius: 6px; font-weight: bold; font-size: 1rem; }
        .old-rating { color: #666; font-size: 0.9rem; text-decoration: line-through; margin-right: 8px; }

        /* –°—Å—ã–ª–∫–∏ */
        .links-area { display: none; margin-top: 10px; padding: 10px; background: #000; border-radius: 5px; }
        .links-area a { color: #ff4444; text-decoration: none; display: block; margin: 5px 0; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>üìä –ú–æ–∏ –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –ò—Ç–æ–≥–∏</h1>

    <div class="calculator">
        <h3>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ú–µ–¥–∏–∞–Ω—ã</h3>
        <p style="font-size: 0.8rem; color: #888;">–í–≤–µ–¥–∏ –æ—Ü–µ–Ω–∫–∏ —Ç—Ä–µ–∫–æ–≤ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä: 7 8 5 10 6)</p>
        <input type="text" id="trackScores" placeholder="–û—Ü–µ–Ω–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª...">
        <button class="btn" onclick="calculateMedian()">–°—á–∏—Ç–∞—Ç—å</button>
        <span id="medianResult" style="margin-left: 15px; font-weight: bold; color: var(--accent);"></span>
    </div>

    <div class="filters">
        <button class="filter-btn active" onclick="render('latest', this)">–ü–æ—Å–ª–µ–¥–Ω–∏–µ</button>
        <button class="filter-btn" onclick="render('best', this)">–¢–æ–ø –ª—É—á—à–∏—Ö</button>
        <button class="filter-btn" onclick="render('worst', this)">–¢–æ–ø —Ö—É–¥—à–∏—Ö</button>
    </div>

    <div id="main-content"></div>
</div>

<script>
    // –ë–ê–ó–ê –î–ê–ù–ù–´–•
    const data = [
        {
            artist: "–õ–∂–µ–¥–º–∏—Ç—Ä–∏–π IV",
            albums: [
                { title: "–ò–æ–≤", ratings: [6.5, 7.1], links: ["#link1", "#link2"], collab: "" },
                { title: "–ê–Ω—Ö–µ–ª—å", ratings: [8.5], links: ["#link3"], collab: "" },
                { title: "–ù–µ–∫—Ä–æ–æ–∞–∑–∏—Å", ratings: [9.0], links: ["#link4"], collab: "" },
                { title: "–°–ò–ù–ï–†–ì–ò–°", ratings: [10], links: ["#link5"], collab: "DEEP-EX-SENSE" }
            ]
        },
        {
            artist: "Oxxxymiron",
            albums: [
                { title: "–ö—Ä–∞—Å–æ—Ç–∞ –∏ –£—Ä–æ–¥—Å—Ç–≤–æ", ratings: [9.5], links: ["#oxxxylink"], collab: "" }
            ]
        }
    ];

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ü–≤–µ—Ç–∞ –æ—Ç 0 (—á–µ—Ä–Ω—ã–π) –¥–æ 10 (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π)
    function getColor(rating) {
        if (rating === 0) return { bg: '#000', color: '#fff', border: '1px solid #fff' };
        
        // –ú–∞–≥–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞: –æ—Ç —á–µ—Ä–Ω–æ–≥–æ –∫ —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–º—É
        const r = Math.round((138 / 10) * rating);
        const g = Math.round((43 / 10) * rating);
        const b = Math.round((226 / 10) * rating);
        return { bg: `rgb(${r},${g},${b})`, color: '#fff', border: 'none' };
    }

    function render(filter = 'latest', btn = null) {
        if(btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        const content = document.getElementById('main-content');
        content.innerHTML = '';

        // –ü–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        let flatList = [];
        data.forEach(author => {
            author.albums.forEach(album => {
                flatList.push({ ...album, artist: author.artist });
            });
        });

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
        if (filter === 'best') flatList.sort((a, b) => b.ratings.at(-1) - a.ratings.at(-1));
        if (filter === 'worst') flatList.sort((a, b) => a.ratings.at(-1) - b.ratings.at(-1));
        if (filter === 'latest') flatList.reverse(); // –ü—Ä–æ—Å—Ç–æ –≤ –ø–æ—Ä—è–¥–∫–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

        // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ –ø–æ –∞—Ä—Ç–∏—Å—Ç—É (—Ç–æ–ª—å–∫–æ –¥–ª—è 'latest', –≤ —Ç–æ–ø–∞—Ö –ª—É—á—à–µ —Å–ø–∏—Å–∫–æ–º)
        if (filter === 'latest') {
            const grouped = {};
            flatList.forEach(item => {
                if (!grouped[item.artist]) grouped[item.artist] = [];
                grouped[item.artist].push(item);
            });

            for (let artist in grouped) {
                const block = document.createElement('div');
                block.className = 'artist-block';
                block.innerHTML = `<div class="artist-name">${artist}</div>`;
                
                grouped[artist].forEach(album => block.appendChild(createAlbumNode(album)));
                content.appendChild(block);
            }
        } else {
            // –î–ª—è –¢–æ–ø–æ–≤ –≤—ã–≤–æ–¥–∏–º –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ —Å –∏–º–µ–Ω–∞–º–∏ –∞—Ä—Ç–∏—Å—Ç–æ–≤
            flatList.forEach(album => {
                const item = createAlbumNode(album, true);
                content.appendChild(item);
            });
        }
    }

    function createAlbumNode(album, showArtist = false) {
        const div = document.createElement('div');
        div.className = 'album-item';
        
        const lastRating = album.ratings.at(-1);
        const style = getColor(lastRating);
        const oldRatingsHtml = album.ratings.slice(0, -1).map(r => `<span class="old-rating">${r}</span>`).join('');
        
        div.innerHTML = `
            <div class="album-header" onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'block' ? 'none' : 'block'">
                <div class="album-title">
                    ${showArtist ? `<strong>${album.artist}: </strong>` : ''}
                    ${album.title} ${album.collab ? `<span class="collab">feat. ${album.collab}</span>` : ''}
                </div>
                <div>
                    ${oldRatingsHtml}
                    <span class="rating-badge" style="background:${style.bg}; color:${style.color}; border:${style.border || 'none'}">
                        ${lastRating}
                    </span>
                </div>
            </div>
            <div class="links-area">
                ${album.links.map((link, i) => `<a href="${link}" target="_blank">üé¨ –°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∞–∫—Ü–∏—é #${i+1}</a>`).join('')}
            </div>
        `;
        return div;
    }

    // –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–µ–¥–∏–∞–Ω—ã
    function calculateMedian() {
        const input = document.getElementById('trackScores').value;
        const numbers = input.split(/\s+/).map(Number).filter(n => !isNaN(n)).sort((a, b) => a - b);
        
        if (numbers.length === 0) return;

        let median;
        const mid = Math.floor(numbers.length / 2);
        if (numbers.length % 2 === 0) {
            median = (numbers[mid - 1] + numbers[mid]) / 2;
        } else {
            median = numbers[mid];
        }
        document.getElementById('medianResult').innerText = "–ú–µ–¥–∏–∞–Ω–∞: " + median.toFixed(2);
    }

    // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
    render();
</script>

</body>
</html>
